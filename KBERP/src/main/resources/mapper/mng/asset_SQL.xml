<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="asset">

<select id="getCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM ASSET A INNER JOIN EMP E
							ON MNGR_NUM = EMP_NUM
		WHERE 1 = 1
		<if test="searchTxt != null and searchTxt != ''">
			<choose>
				<when test="searchGbn == 0">
					AND ASSET_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND EMP_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>
		</if>
	</select>
	 <select id="assetMngList" resultType="hashmap" parameterType="hashmap">
		SELECT *
		FROM (SELECT ASSET_NUM, ASSET_NAME, ASSET_TYPE_NUM, QUNTY, QUNTY_DVSN_NUM, EMP_NAME,TO_CHAR(ACQRMNT_DATE, 'YYYY-MM-DD')AS ACQRMNT_DATE,
		 TO_CHAR(RGSTRTN_DATE, 'YYYY-MM-DD')AS RGSTRTN_DATE,ROW_NUMBER() OVER(ORDER BY ASSET_NUM DESC) AS RNUM
			FROM ASSET INNER JOIN EMP
			                    ON MNGR_NUM = EMP_NUM
			WHERE 1=1
		<if test="searchTxt != null and searchTxt != ''"> 
					<choose>
						<when test="searchGbn == 0">
							AND ASSET_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
						<when test="searchGbn == 1">
							AND EMP_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
					</choose>
				</if>
				) A
				WHERE A.RNUM BETWEEN #{startCount} AND #{endCount} 
	</select>
	
	<select id="assetDtlViewDrbl" resultType="hashmap" parameterType="hashmap">
      SELECT  ASSET_NUM, ASSET_NAME, ASSET_TYPE_NUM, ACQRMNT_DATE, A.EMP_NAME, USERNAME
        FROM(
        SELECT ASSET_NUM, ASSET_NAME, ASSET_TYPE_NUM, TO_CHAR(ACQRMNT_DATE, 'YYYY-MM-DD')AS ACQRMNT_DATE,
       EMP_NAME, A.RMRKS
      FROM ASSET A INNER JOIN EMP E
                ON A.MNGR_NUM = E.EMP_NUM
        WHERE ASSET_NUM = #{num}) A LEFT OUTER JOIN
        (SELECT EMP_NAME AS USERNAME
        FROM ASSET_USE AU INNER JOIN EMP E
                            ON AU.EMP_NUM = E.EMP_NUM
                            INNER JOIN ASSET A
                            ON A.ASSET_NUM = AU.ASSET_NUM
                            WHERE A.ASSET_NUM = #{num}) B
                            ON 1=1
   </select>
	
	
	<select id="assetDtlViewExpndblt" resultType="hashmap" parameterType="hashmap">
		SELECT ASSET_NUM, ASSET_NAME, ASSET_TYPE_NUM, TO_CHAR(ACQRMNT_DATE, 'YYYY-MM-DD')AS ACQRMNT_DATE,
		 EMP_NAME, QUNTY, QUNTY_DVSN_NUM, A.RMRKS
		FROM ASSET A INNER JOIN EMP E
                ON A.MNGR_NUM = E.EMP_NUM
        WHERE ASSET_NUM = #{num}
	</select>
	
	<insert id="assetRgstrtn" parameterType="hashmap">
		INSERT INTO ASSET(ASSET_NUM, ASSET_NAME, RGSTRTN_EMP_NUM, MNGR_NUM, ASSET_TYPE_NUM, QUNTY, QUNTY_DVSN_NUM, ACQRMNT_DATE)
		VALUES(ASSET_SEQ.NEXTVAL, #{assetName}, #{writer}, #{mngrNum}, #{assetType}, #{qunty}, #{quntyDvsnNum}, #{acqrmntDt})
	</insert>
	
	<update id="drblMdfy" parameterType="hashmap">
		UPDATE ASSET SET MNGR_NUM = #{mngrNum},
              	   	 RMRKS =#{rmrks}
		WHERE ASSET_NUM = #{num}
	</update>
	
	<update id="expndbltMdfy" parameterType="hashmap">
		UPDATE ASSET SET MNGR_NUM = #{mngrNum},
              	   	 QUNTY = #{qunty},
              	   	 RMRKS = #{rmrks}
		WHERE ASSET_NUM = #{num}
	</update>

	<select id="getRntlCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM ASSET_USE AU INNER JOIN EMP E
							ON AU.EMP_NUM = E.EMP_NUM
						  INNER JOIN ASSET A
						  	ON AU.ASSET_NUM = A.ASSET_NUM
						  	
		WHERE 1 = 1
		<if test="searchTxt != null and searchTxt != ''">
			<choose>
				<when test="searchGbn == 0">
					AND A.ASSET_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND E.EMP_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>
		</if>
	</select>
	
	<select id="assetRntlList" resultType="hashmap" parameterType="hashmap">
		 SELECT ASSET_USE_NUM, ASSET_NUM, ASSET_NAME, EMP_NAME, START_DATE, END_DATE
		FROM (SELECT ASSET_USE_NUM, AU.ASSET_NUM, ASSET_NAME, EMP_NAME,TO_CHAR(START_DATE, 'YYYY-MM-DD')AS START_DATE,
		 TO_CHAR(END_DATE, 'YYYY-MM-DD')AS END_DATE,ROW_NUMBER() OVER(ORDER BY ASSET_USE_NUM DESC) AS RNUM
			FROM ASSET_USE AU INNER JOIN EMP E
			                    ON AU.EMP_NUM = E.EMP_NUM
			                   INNER JOIN ASSET A
			                   	ON AU.ASSET_NUM = A.ASSET_NUM
			WHERE 1=1
		<if test="searchTxt != null and searchTxt != ''"> 
					<choose>
						<when test="searchGbn == 0">
							AND A.ASSET_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
						<when test="searchGbn == 1">
							AND E.EMP_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
					</choose>
				</if>
				) A
				WHERE A.RNUM BETWEEN #{startCount} AND #{endCount} 
	</select>
	
	<select id="assetRntlDtlView" resultType="hashmap" parameterType="hashmap">
		SELECT A.ASSET_NUM, ASSET_NAME, A.EMP_NAME, B.USENAME, START_DATE, END_DATE,B.RMRKS
        FROM( SELECT ASSET_NUM,ASSET_NAME,EMP_NAME
      FROM ASSET A INNER JOIN EMP E
                   ON A.MNGR_NUM = E.EMP_NUM
               WHERE ASSET_NUM=#{num}) A INNER JOIN
     (SELECT TO_CHAR(START_DATE,'YYYY-MM-DD')AS START_DATE, TO_CHAR(END_DATE,'YYYY-MM-DD')AS END_DATE,EMP_NAME AS USENAME,RMRKS
      FROM ASSET_USE AU INNER JOIN EMP E
                   ON AU.EMP_NUM = E.EMP_NUM
                   WHERE ASSET_NUM=#{num} AND ASSET_USE_NUM =#{unum}) B
        ON 1=1
	</select>
	
	<update id="rntlMdfy" parameterType="hashmap">
		UPDATE ASSET_USE SET END_DATE = #{endDt},
              	   	 RMRKS = #{rmrks}
		WHERE ASSET_NUM = #{num}
	</update>
	
	<insert id="assetRntlRgstrtn" parameterType="hashmap">
		INSERT INTO ASSET_USE(ASSET_USE_NUM, ASSET_NUM, EMP_NUM, RMRKS, START_DATE)
		VALUES(ASSET_USE_SEQ.NEXTVAL, #{assetNum}, #{empNum}, #{rmrks}, #{startDt})
	</insert>
	
	<select id="getTktCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM ASSET A INNER JOIN ASSET_TKT AT
							ON A.ASSET_NUM = AT.ASSET_NUM
						  INNER JOIN EMP E
						  	ON A.MNGR_NUM = E.EMP_NUM						  	
		WHERE 1 = 1
		<if test="searchTxt != null and searchTxt != ''">
			<choose>
				<when test="searchGbn == 0">
					AND A.ASSET_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND E.EMP_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>
		</if>
	</select>
	
	<select id="assetTktList" resultType="hashmap" parameterType="hashmap">
		SELECT TKT_NUM, ASSET_NUM, A.ASSET_NAME,MNGR_NAME, QUNTY, QUNTY_DVSN_NUM,TKT_DATE
		FROM ( SELECT TKT_NUM, AT.ASSET_NUM, A.ASSET_NAME, EMP_NAME AS MNGR_NAME, AT.QUNTY,
			 AT.QUNTY_DVSN_NUM,TO_CHAR(TKT_DATE, 'YYYY-MM-DD')AS TKT_DATE,ROW_NUMBER() OVER(ORDER BY TKT_NUM DESC) AS RNUM
			FROM ASSET A INNER JOIN ASSET_TKT AT
			                    ON A.ASSET_NUM = AT.ASSET_NUM
			                   INNER JOIN EMP E
			                   	ON A.MNGR_NUM = E.EMP_NUM
			WHERE 1=1
		<if test="searchTxt != null and searchTxt != ''"> 
					<choose>
						<when test="searchGbn == 0">
							AND A.ASSET_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
						<when test="searchGbn == 1">
							AND EMP_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
					</choose>
				</if>
				) A
				WHERE A.RNUM BETWEEN #{startCount} AND #{endCount} 
	</select>
	
	<select id="assetTktDtlView" resultType="hashmap" parameterType="hashmap">
		SELECT A.ASSET_NUM, ASSET_NAME, QUNTY, QUNTY_DVSN_NUM, MNGR_NAME,USENAME, TKT_DATE,RMRKS
		FROM(
    		SELECT ASSET_NUM, QUNTY, QUNTY_DVSN_NUM, EMP_NAME AS USENAME, TO_CHAR(TKT_DATE, 'YYYY-MM-DD')AS TKT_DATE,RMRKS
    		FROM ASSET_TKT INNER JOIN EMP 
                    ON TKT_EMP_NUM = EMP_NUM
                    WHERE ASSET_NUM=#{num}  AND TKT_NUM= #{tktnum}) A LEFT OUTER JOIN (                 
    		SELECT ASSET_NUM, ASSET_NAME,EMP_NAME AS MNGR_NAME
    		FROM ASSET INNER JOIN EMP
                ON MNGR_NUM = EMP_NUM
                WHERE ASSET_NUM=#{num}) B
                ON 1=1
	</select>
	
	<insert id="assetTktRgstrtn" parameterType="hashmap">
		INSERT INTO ASSET_TKT(TKT_NUM, RGSTRTN_EMP_NUM, ASSET_NUM, TKT_EMP_NUM, RMRKS, TKT_DATE, QUNTY, QUNTY_DVSN_NUM)
		VALUES(ASSET_TKT_SEQ.NEXTVAL, #{rgstrtnEmpNum}, #{assetNum}, #{empNum}, #{rmrks}, #{tktdt}, #{qunty}, #{quntynum})
	</insert>
	
	<!-- 시설물등록시 관리자리스트 -->
<select id="getEmpList" resultType="hashmap" parameterType="hashmap">
	SELECT O.EMP_NUM,O.EMP_NAME
	FROM       ( SELECT A.EMP_NUM,E.EMP_NAME,ROW_NUMBER() OVER(ORDER BY E.EMP_NUM DESC) AS RNUM
        		FROM DEPT D INNER JOIN APNTM A
                    		ON D.DEPT_NUM = A.DEPT_NUM
                   			INNER JOIN EMP E
                    		ON A.EMP_NUM = E.EMP_NUM
        		WHERE D.DEPT_NUM = 5 
	             <if test="sendSrchTxt != null and sendSrchTxt != ''">
	             	AND E.EMP_NAME LIKE '%' || #{sendSrchTxt} || '%'
	             </if>
	            )O
	WHERE O.RNUM BETWEEN #{startCount} AND #{endCount}
	
</select>

<!-- 시설물등록시 관리자리스트 cnt-->
<select id="getEmpCnt" resultType="Integer" parameterType="hashmap">
	SELECT COUNT(*)
	FROM(   SELECT A.EMP_NUM,E.EMP_NAME,ROW_NUMBER() OVER(ORDER BY E.EMP_NUM DESC) AS RNUM
       		FROM DEPT D INNER JOIN APNTM A
                    ON D.DEPT_NUM = A.DEPT_NUM
                    INNER JOIN EMP E
                    ON A.EMP_NUM = E.EMP_NUM
       		WHERE D.DEPT_NUM = 5 
		<if test="sendSrchTxt != null and sendSrchTxt != ''">
			AND E.EMP_NAME LIKE '%' || #{sendSrchTxt} || '%'
		</if>
		) 
</select>
</mapper>