<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="expnsRsltnadmnstr">
	<select id="getExpnsCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM (  SELECT ROW_NUMBER() OVER(ORDER BY TO_CHAR(DATE_HR, 'YYYY-MM') DESC) AS RNUM
		        FROM EXPNS_RSLTN INNER JOIN EMP
		                                ON EXPNS_RSLTN.EMP_NUM = EMP.EMP_NUM
		        WHERE 1 = 1
		        <if test="searchTxt != null and searchTxt != ''">
					<if test="month != null and month != ''">
						AND EMP_NAME = #{searchTxt}
						AND TO_CHAR(DATE_HR, 'YYYY-MM') = #{month}			
					</if>
					AND EMP_NAME = #{searchTxt}
				</if>
		        GROUP BY TO_CHAR(DATE_HR, 'YYYY-MM'), EMP_NAME )
	</select>
	
	<select id="getExpnsList" resultType="hashmap" parameterType="hashmap">
		SELECT TO_CHAR(DATE_HR, 'YYYY-MM') AS DATE_MON, EMP_NAME, SUM(DECODE(ER.EXPNS_TYPE, '법인', AMNT)) AS CRP, 
     		   SUM(DECODE(EXPNS_TYPE, '개인', AMNT)) AS IND, SUM(AMNT) AS TOTAL
		FROM EXPNS_RSLTN ER INNER JOIN EMP E
                    		        ON ER.EMP_NUM = E.EMP_NUM
		WHERE 1 = 1
		<if test="searchTxt != null and searchTxt != ''">
			AND EMP_NAME = #{searchTxt}
		</if>
		<if test="month != null and month != ''">
			AND TO_CHAR(DATE_HR, 'YYYY-MM') = #{month}	
		</if>
		GROUP BY TO_CHAR(DATE_HR, 'YYYY-MM'), EMP_NAME
		ORDER BY TO_CHAR(DATE_HR, 'YYYY-MM') DESC		
	</select>

</mapper>