<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChitMng">
	<select id="getChitMngCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM (  SELECT CHIT_NUM, ACNT_NUM, AMNT, RMRKS
		        FROM (  SELECT CHIT_NUM, ACNT_NUM, AMNT, RMRKS, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
		                FROM EXPNS_RSLTN ER INNER JOIN ACNT_CODE AC
		                                            ON ER.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
		                                           AND AC.MAIN_CTGR_ACNT_CODE = 1
		                UNION
		                SELECT CHIT_NUM, ACNT_NUM, AMNT, RMRKS, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
		                FROM INTRNL_COST_MNG ICM INNER JOIN ACNT_CODE AC
		                                                 ON ICM.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
		                                                AND AC.MAIN_CTGR_ACNT_CODE = 1  )
		        WHERE MONTH = #{mon}  )
	</select>
	
	<select id="getChitMngList" resultType="hashmap" parameterType="hashmap">
		SELECT CHIT_NUM, TO_CHAR(AMNT, '999,999,999,999') AS AMNT, RMRKS
		FROM (  SELECT CHIT_NUM, AMNT, RMRKS, ROW_NUMBER() OVER(ORDER BY CHIT_NUM DESC) AS RNUM
				FROM (  SELECT CHIT_NUM, ACNT_NUM, AMNT, RMRKS, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
				        FROM EXPNS_RSLTN ER INNER JOIN ACNT_CODE AC
				                                    ON ER.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
				                                   AND AC.MAIN_CTGR_ACNT_CODE = 1
				        UNION
				        SELECT CHIT_NUM, ACNT_NUM, AMNT, RMRKS, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
				        FROM INTRNL_COST_MNG ICM INNER JOIN ACNT_CODE AC
				                                         ON ICM.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
				                                        AND AC.MAIN_CTGR_ACNT_CODE = 1  )
				WHERE MONTH = #{mon}  ) C
		WHERE C.RNUM BETWEEN #{startCount} AND #{endCount}
	</select>
	
	<select id="getChitMngData" resultType="hashmap" parameterType="hashmap">
		SELECT TO_CHAR(SUM(AMNT), '999,999,999,999') AS DEVIT_SUM
		FROM (  SELECT CHIT_NUM, AMNT, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
		        FROM EXPNS_RSLTN ER INNER JOIN ACNT_CODE AC
		                                    ON ER.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
		                                   AND AC.MAIN_CTGR_ACNT_CODE = 1
		        UNION
		        SELECT CHIT_NUM, AMNT, TO_CHAR(DATE_HR, 'YYYY-MM') AS MONTH
		        FROM INTRNL_COST_MNG ICM INNER JOIN ACNT_CODE AC
		                                         ON ICM.ACNT_NUM = AC.SUB_CTGR_ACNT_CODE
		                                        AND AC.MAIN_CTGR_ACNT_CODE = 1  )
		WHERE MONTH = #{mon}
	</select>
	
	<select id="expnsRsltnCheck" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM EXPNS_RSLTN
		WHERE CHIT_NUM = #{sendChitNum}
	</select>
	
	<select id="intrnlCostCheck" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM INTRNL_COST_MNG
		WHERE CHIT_NUM = #{sendChitNum}
	</select>
	
	
</mapper>