<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="elctrncAprvl">
	<select id="getAprvlTmpltBox" resultType="hashmap" parameterType="hashmap">
		SELECT E.TMPLT_NUM, E.TMPLT_DVSN_NUM, E.TMPLT_NAME, E.TMPLT_CONT, D.TMPLT_DVSN_NAME, E.DEL_CHECK, ROW_NUMBER()OVER(ORDER BY TMPLT_NUM ASC) AS RNUM
		FROM(SELECT TMPLT_NUM, TMPLT_DVSN_NUM, TMPLT_NAME, TMPLT_CONT, DEL_CHECK,ROW_NUMBER()OVER(ORDER BY TMPLT_NUM ASC) AS RNUM
		FROM DRAFT_TMPLT) E INNER JOIN DRAFT_TMPLT_DVSN D
		ON E.TMPLT_DVSN_NUM = D.TMPLT_DVSN_NUM
	</select>

	<select id="draftTmpltBoxWrite" parameterType="hashmap">
	
	</select>

<select id = "aprvlSeq" resultType="String">
	SELECT APRVL_SEQ.NEXTVAL
	FROM DUAL
</select>

<insert id = "aprvlLineAdd" parameterType="hashmap">
	INSERT INTO APRVL (APRVL_NUM, EMP_NUM, TITLE, CONT, DRAFT_DATE)
	VALUES(#{al}, #{empNum}, #{title}, #{cont}, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
</insert>

<select id = "aprvlRfrncSeq" resultType="String"> 
	SELECT APRVL_RFRNC_SEQ.NEXTVAL
	FROM DUAL
</select>
<insert id="aprvlAdd" parameterType="hashmap">
	INSERT INTO APRVL (APRVL_NUM, EMP_NUM, TITLE, CONT)
	VALUES(#{aprvl_num}, #{emp_num}, #{title}, #{cont})
</insert>
<insert id="aprvlerAdd" parameterType="hashmap">
	INSERT INTO APRVL_LINE (APRVL_NUM, EMP_NUM, APRVL_TURN)
	VALUES(#{aprvl_num}, #{aprvler}, #{aprvl_turn}) 
</insert>
<insert id="rfrncAdd" parameterType="hashmap">
	INSERT INTO APRVL_RFRNC (APRVL_NUM, EMP_NUM)
	VALUES(#{aprvl_num}, #{rfrnc}) 
</insert>

<select id = "aprvlResult" resultType="String">
	SELECT  DISTINCT CASE WHEN APRVL_STS = 0 THEN '대기'
        				  WHEN APRVL_STS = 1 THEN '승인'
        				  WHEN APRVL_STS = 2 THEN '거부'
    END AS  APRVL_STS
	FROM APRVL_LINE
	WHERE APRVL_NUM = #{aprvl_num} 
</select>

</mapper>
