<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
<select id="getBoardCnt" resultType="Integer" parameterType="hashmap">
		SELECT COUNT(*) AS CNT
		FROM BOARD B INNER JOIN EMP E
            				ON B.EMP_NUM = E.EMP_NUM
		WHERE 1 = 1
		<if test="searchTxt != null and searchTxt != ''">
			<choose>
				<when test="searchGbn == 0">
					 AND BOARD_TITLE LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					 AND E.EMP_NAME LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>
		</if>
		
	</select>
<select id ="getBoardList" resultType="hashmap" parameterType="hashmap">
		SELECT *
		FROM (  SELECT B.WRTNG_NUM, B.BOARD_TITLE, E.EMP_NAME,
               B.BOARD_HITS, TO_CHAR(BOARD_WRTNG_DATE, 'YYYY-MM-DD') AS BOARD_WRTNG_DATE,
               ROW_NUMBER() OVER(ORDER BY B.WRTNG_NUM DESC) AS RNUM
		        FROM BOARD B INNER JOIN EMP E
		                                ON B.EMP_NUM = E.EMP_NUM
		        WHERE 1 = 1
		        <if test="searchTxt != null and searchTxt != ''">
					<choose>
						<when test="searchGbn == 0">
							 AND B.BOARD_TITLE LIKE '%' || #{searchTxt} || '%'
						</when>
						<when test="searchGbn == 1">
							 AND E.EMP_NAME LIKE '%' || #{searchTxt} || '%'
						</when>
						
					</choose>
				</if>
		    ) A
		WHERE A.RNUM BETWEEN #{startCount} AND #{endCount}
	</select>
	<select id="boardView" resultType="hashmap" parameterType="hashmap">
	SELECT B.WRTNG_NUM, B.BOARD_TITLE, B.BOARD_CONT, E.EMP_NAME,
	     		   BOARD_HITS, TO_CHAR(BOARD_WRTNG_DATE, 'YYYY-MM-DD-HH24:MI') AS BOARD_WRTNG_DATE,
	     		   B.ATCHD_FILE, B.BOARD_ADMNSTRTN_NUM, B.DEL_CHECK
	    FROM BOARD B INNER JOIN EMP E
	                    ON B.EMP_NUM = E.EMP_NUM
	    WHERE B.WRTNG_NUM = #{no}
	</select>
	<update id="updateBoardViewHit" parameterType="hashmap">
		 UPDATE BOARD SET BOARD_HITS = BOARD_HITS + 1
		 WHERE WRTNG_NUM = #{no}
	</update>
	<insert id="boardWrite" parameterType="hashmap">
			INSERT INTO BOARD(WRTNG_NUM, BOARD_TITLE, EMP_NUM, BOARD_CONT, BOARD_ADMNSTRTN_NUM)
		VALUES(BOARD_SEQ.NEXTVAL, #{title}, #{writer}, #{con} , #{admstrtn_num})
	</insert>
</mapper>