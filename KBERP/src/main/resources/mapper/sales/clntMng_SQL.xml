<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="clntCmpny">

	<select id="getClntCmpntList" parameterType="hashmap" resultType="hashmap">
		SELECT CC.CLNT_CMPNY_NUM, CC.GRADE_NAME, CC.CLNT_CMPNY_CLSFY_NAME, CC.CLNT_CMPNY_NAME,
		       CC.RVN, CC.ADRS, CC.CNTRCT_CNT
		FROM(   SELECT ROW_NUMBER() OVER(ORDER BY CC.CLNT_CMPNY_NUM DESC) AS RNUM,
		               CC.CLNT_CMPNY_NUM, CCG.GRADE_NAME, CCC.CLNT_CMPNY_CLSFY_NAME, CC.CLNT_CMPNY_NAME,
		               CC.RVN, CC.ADRS, CCNT.CNT AS CNTRCT_CNT
		        FROM CLNT_CMPNY CC INNER JOIN CLNT_CMPNY_GRADE CCG
		                                   ON CC.GRADE_NUM = CCG.GRADE_NUM 
		                           INNER JOIN CLNT_CMPNY_CLSFY CCC
		                                   ON CC.CLNT_CMPNY_CLSFY_NUM = CCC.CLNT_CMPNY_CLSFY_NUM
		                           INNER JOIN ( SELECT CC.CLNT_CMPNY_NAME, COUNT(*) AS CNT
		                                        FROM CLNT_CMPNY CC INNER JOIN ENTRPRS_CLNT EC
		                                                                   ON CC.CLNT_CMPNY_NUM = EC.CLNT_CMPNY_NUM
		                                                           INNER JOIN LEAD L
		                                                                   ON L.CLNT_NUM = EC.CLNT_CMPNY_NUM
		                                                           INNER JOIN SALES S
		                                                                   ON S.LEAD_NUM = L.LEAD_NUM
		                                                           INNER JOIN CNTRCT C
		                                                                   ON C.SALES_NUM = S.SALES_NUM
		                                        GROUP BY CC.CLNT_CMPNY_NAME ) CCNT
		                                   ON CC.CLNT_CMPNY_NAME = CCNT.CLNT_CMPNY_NAME ) CC
		WHERE CC.RNUM BETWEEN #{startCount} AND #{endCount}
		AND 1 = 1
	</select>
	
	<select id="clntCmpnyCnt" parameterType="hashmap" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE 1 = 1
	</select>
	
	<select id="getClntList" parameterType="hashmap" resultType="hashmap">
		SELECT ROW_NUMBER() OVER(ORDER BY EC.CLNT_NUM DESC) AS RNUM, EC.CLNT_NUM, EC.DEPT, EC.DUTY,
		       EC.EMAIL, CC.CLNT_CMPNY_NAME, EC.CLNT_NAME, EC.MBL 
		FROM ENTRPRS_CLNT EC INNER JOIN CLNT_CMPNY CC
		                             ON EC.CLNT_CMPNY_NUM = CC.CLNT_CMPNY_NUM
		WHERE 1 = 1
	</select>
	
	<select id="clntCnt" parameterType="hashmap" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM ENTRPRS_CLNT
		WHERE 1 = 1
	</select>
	
</mapper>