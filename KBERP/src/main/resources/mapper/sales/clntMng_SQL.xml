<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="clntCmpnyMng">

	<select id="getClntCmpntList" parameterType="hashmap" resultType="hashmap">
		SELECT A.RNUM, A.CLNT_CMPNY_NUM, A.GRADE_NAME, A.CLNT_CMPNY_CLSFY_NAME, A.CLNT_CMPNY_NAME, A.ADRS, A.RVN, A.CNT
		FROM (SELECT A.RNUM, A.CLNT_CMPNY_NUM, A.GRADE_NAME, A.CLNT_CMPNY_CLSFY_NAME, A.CLNT_CMPNY_NAME, A.ADRS, A.RVN, NVL(B.CNT, 0) AS CNT,
		             ROW_NUMBER() OVER(ORDER BY A.RNUM DESC) AS RNUM2
		      FROM (  SELECT ROW_NUMBER() OVER(ORDER BY CC.CLNT_CMPNY_NUM ASC) AS RNUM, CC.CLNT_CMPNY_NUM, CCG.GRADE_NAME, CCC.CLNT_CMPNY_CLSFY_NAME,
		                     CC.CLNT_CMPNY_NAME, CC.RVN, CC.ADRS || CC.DTL_ADRS AS ADRS
		              FROM CLNT_CMPNY CC INNER JOIN CLNT_CMPNY_GRADE CCG
		                                         ON CC.GRADE_NUM = CCG.GRADE_NUM
		                                 INNER JOIN CLNT_CMPNY_CLSFY CCC
		                                         ON CC.CLNT_CMPNY_CLSFY_NUM = CCC.CLNT_CMPNY_CLSFY_NUM ) A LEFT OUTER JOIN ( SELECT CC.CLNT_CMPNY_NAME, COUNT(*) AS CNT
		                                                                                                                     FROM CLNT_CMPNY CC INNER JOIN ENTRPRS_CLNT EC
		                                                                                                                                                ON CC.CLNT_NAME = EC.CLNT_NAME
		                                                                                                                                        INNER JOIN LEAD L
		                                                                                                                                                ON L.CLNT_NUM = EC.CLNT_NUM 
		                                                                                                                                        INNER JOIN SALES S
		                                                                                                                                                ON S.LEAD_NUM = L.LEAD_NUM
		                                                                                                                                        INNER JOIN CNTRCT C
		                                                                                                                                                ON C.SALES_NUM = S.SALES_NUM
		                                                                                                                     GROUP BY CC.CLNT_CMPNY_NAME ) B
		                                                                                                                ON A.CLNT_CMPNY_NAME = B.CLNT_CMPNY_NAME ) A
		WHERE A.RNUM2 BETWEEN #{startCount} AND #{endCount}
	</select>
	
	<select id="clntCmpnyListCnt" parameterType="hashmap" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
	</select>
	
	<insert id="getClntCmpnyAdd" parameterType="hashmap">
		INSERT INTO CLNT_CMPNY (CLNT_CMPNY_NUM, CLNT_CMPNY_CLSFY_NUM, GRADE_NUM, RCGNTN_PATH_NUM, CLNT_CMPNY_NAME, BSNSMN_RGSTRTN_NUM,
							    CLNT_NAME, PHONE_NUM, FAX, HMPG, ZIP_CODE_NUM, ADRS, DTL_ADRS, RVN, EMP_NUM)
		VALUES (CLNT_CMPNY_SEQ.NEXTVAL, #{ccClsfy}, #{ccGrade}, #{rp}, #{ccName}, #{brNum}, #{cName}, #{phoneNum}, #{fax}, #{hmpg},
			    #{zipCodeNum}, #{adrs}, #{dtlAdrs}, #{rvn}, #{sEmpNum})
	</insert>
	
	<select id="clntCmpnyCntrctCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 0
	</select>

	<select id="clntCmpnyPartnerCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 1
	</select>
	
	<select id="clntCmpnyTmnCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 2
	</select>
	
	<select id="clntCmpnySspsCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 3
	</select>
	
	<select id="clntCmpnyForeignCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 4
	</select>
	
	<select id="clntCmpnyEtcCnt" resultType="Integer">
		SELECT COUNT(*) AS CNT
		FROM CLNT_CMPNY
		WHERE CLNT_CMPNY_CLSFY_NUM = 5
	</select>

</mapper>